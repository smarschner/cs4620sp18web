<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>CS 4621: PPA2 -- Data Visualization</title>

    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/cs4620.css" rel="stylesheet">
    <link href="../css/jquery-ui.min.css" rel="stylesheet">
    <link href="../css/jquery-ui.theme.min.css" rel="stylesheet">
    <link href="../css/jquery-ui.structure.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });


    </script>
    <!-- MathJax -->
    <script type="text/javascript" async
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
<div class="container">
    <h1>CS 4621 PPA2 <span class="subtitle">Data Visualization</span></h1>
    <p class="courseinfo">Out: Friday March 3, 2017</p>
    <p class="courseinfo">Due: Friday March 17, 2017 at 11:59pm</p>
    <p class="courseinfo">Work in groups of up to 4</p>

    <h2>Overview</h2>

    <p>
        In this programming assignment, you will implement a visualization tool for a dataset consisting of the
        population, GDP per capita, and life expectancy of 195 countries from 1800 to 2015. We took this dataset
        from <a href="http://www.gapminder.org/">Gapminder</a>, a web site created by Swedish professor
        <a href="https://en.wikipedia.org/wiki/Hans_Rosling">Hans Rosling</a> and his son Ola Rosling.
        (It's very unfortunate that Hans passed away early in February.) What we ask you to do in this assignment is
        to reproduce a number of functionalities of the visualization software hosted on the Gapminder site,
        using WebGL and Javascript.
    </p>

    <p><b>WARNING: WE THINK THIS ASSIGNMENT IS LONGER THAN THE LAST ONE. START EARLY.</b></p>

    <h2>What You Code Should Be Able to Do</h2>

    <center>
        <iframe width="560" height="315" src="https://www.youtube.com/embed/LTV2EBb68dw" frameborder="0"
                allowfullscreen></iframe>
    </center>

    <h2>Logistics</h2>

    <p>
        First, clone the <a href="https://github.com/smarschner/4620sp17web">CS 4620 web repository</a>.
        You will find the template code for this assignment in the <code>cs4621/ppa02_student</code> directory.
    </p>

    <p>
        Inside the directory, open <code>index.html</code>, and you should see a web page with only the page's
        header and some text asking you to list your team members.
    </p>

    <p>
        Please modify <code>index.html</code> so that it visualizes the data in a way similar to what you saw
        in the video. You may also add other code to the directory. However, do not use any 3D rendering
        framework such as <a href="https://threejs.org/">three.js</a>. Linear algebra libraries such as
        <a href="http://glmatrix.net/">glMatrix</a> are fine. Our solution code, however, does not use any
        extra code besides what is already in the ZIP file.
    </p>

    <p>
        Once you're done writing your solution, ZIP the <code>cs4621/ppa02_student</code>, and submit
        the ZIP file to CMS.
    </p>

    <h2>Features</h2>

    <p>
        Your submission will be graded by features that it implements. More features, more points.
        You do not have to implement the features exactly as we did in the videos to get the points.
        Think of the course staff as customers who want to use your software to look at the data.
        We'll be satisfied if you implement features that satisfy the requirements, work out of the box,
        and are easy to use. The features are as follows.
    </p>

    <h3>WebGL Rendering</h3>

    <ol>
        <li>
            You submission must render the bubbles and the grid lines using WebGL on a canvas.
            Don't use other graphics libraries.
        </li>
        <li>
            Make the background color of the canvas something other than white so that we can distinguish
            between the canvas and the web page's background.
        </li>
        <li>
            Draw vertical and horizontal grid lines so that we can distinguish whether the system is
            currently using a linear scale or a logarithmic scale.
        </li>
        <li>
            Draw the bubble of a country in a certain year so that:
            <ul>
                <li>
                    the area of the bubble is proportional to the population
                    of the country that year,
                </li>
                <li>
                    the $x$-coordinate of the center of the bubble corresponds to the country's GDP per capita
                    that year, and
                </li>
                <li>
                    the $y$-coordinate of the center of the bubble corresponds to the country's life expectancy
                    that year.
                </li>
            </ul>
        </li>
        <li>
            Color the bubbles according to the regions of the countries.
        </li>
    </ol>

    <h3>User Interaction</h3>

    <ol>
        <li>
            A part of the web page should display the GDP per capita and the life expectancy that correspond
            to the point the mouse cursor is located at.
        </li>
        <li>
            If the mouse pointer is over a bubble of a country:
            <ul>
                <li>A part of the web page should display information about that country, including its name,
                    GDP per capita, and life expectancy in the year corresponding to the bubble.
                </li>
                <li>The system should make the bubble conspicuous by making other bubbles more transparent
                    (according to the transparency specified by the "Transparency" slider). It should also
                    draw the bubble in a way that makes it clear that it's highlighted (e.g. we draw with a color that is different from the color of the bubble's region, and put three circles around it.)
                </li>
            </ul>
        </li>
        <li>
            The user should be able to drag the slider to change the year that is being displayed.
            The canvas should update accordingly.
        </li>
        <li>The "Play!" button should work as indicated in the video. That is:
            <ul>
                <li>
                    Once the user clicks the button, the year and the slider should progress forward automatically.
                    The "Play!" button should become the "Stop!" button.
                </li>
                <li>
                    If the slider reaches year 2015, the progression of the year should stop and the "Stop!" button
                    should change back to the "Play!" button.
                </li>
                <li>
                    If the user clicks the "Stop!" button while the year is progressing, the progress should stop
                    there and the "Stop!" button should change back to the "Play!" button.
                </li>
            </ul>
        </li>
        <li>
            When at least one trend curve is on display, the bubbles not on any trend curve should become
            transparent. The transparency of these bubbles should be controlled by the "Transparency" slider
        </li>
    </ol>

    <h3>Trend Curves</h3>

    <ol>
        <li>The user should be able to select one or multiple countries to display their "trend curves."</li>
        <li>If a country is chosen, its trend curve should be displayed by:
            <ul>
                <li>
                    Drawing all the bubbles of that country from 1800 to the current year according to the year slider.
                    The bubbles should be opaque.
                </li>
                <li>
                    Drawing line segments connecting bubbles of consecutive years. The line should have the same color
                    as the region of the country.
                </li>
            </ul>
        </li>
        <li>
            The implementation should provide at least the following two ways to
            select/deselect countries for displaying trend curves.
            <ol>
                <li>It should provide checkboxes, each corresponding to a country.</li>
                <li>
                    The user may also click a bubble on the canvas to display the country's trend curve.
                    If the user click on any bubble on that trend curve again, the curve should disappear.
                </li>
            </ol>
        </li>
        <li>
            The implementation should keep the UI elements consistent with the list of selected countries.
            In other words, if the user selects/deselect a country by clicking on a bubble, the checkbox
            corresponding to that country should be updated appropriately.
        </li>
        <li>
            The implemention must provide a "Deselect All" button that, when clicked, should deselect
            all the countries currently being selected to display their trend curves.
        </li>
    </ol>

    <h3>Display Customization</h3>

    <ol>
        <li>
            The implementation should allow the user to choose whether to display the GPD per capita
            and the life expentancy with a linear scale of a logarithmic scale.
        </li>
        <li>
            The implementation should allow the user to set the scaling factor that is used to
            derive the size of the bubble with respect to the population.
        </li>
        <li>
            The implemention should provide a slider that allows the user to control the transparency of
            the bubbles that are obscured so that it becomes easy to see bubbles on the trend curve of
            the bubble under the mouse cursor.
        </li>
    </ol>

    <h3>Extra Credits</h3>

    <p>The features below are not implemented by the reference solution. Implement them to get extra credits.</p>

    <ol>
        <li>
            <b>Smooth animation.</b> From the video, you will see that when we click "Play!," the animation
            is jumpy because we do not interpolate bubbles between frames. Implement between-frame interpolation
            and to get smooth animation.
        </li>
        <li>
            <b>Tooltips.</b> Information about a particular bubble is displayed in a separate table in the
            reference implementation. This is rather inconvenient because the table is far away from the
            canvas. Implement your visualization tool so that it shows a bubble's info as a tooltip
            that appears near the mouse pointer instead.
        </li>
        <li>
            <b>Zooming.</b> Implement your submission so that it allows the user to zoom in to the area
            of the canvas they are interested in and also out to the canonical view.
        </li>
        <li>
            <b>Other datasets.</b> Dig up some other datasets from the
            <a href="http://www.gapminder.org">Gapminder web site</a> and allow the user to choose which one to
            display.
        </li>
    </ol>

    <h2>Implementation Details</h2>

    <p>The dataset is contained in the following 4 Javascript files:
    <ul>
        <li><code>ppa02_student/data/country_list.js</code></li>
        <li><code>ppa02_student/data/population.js</code></li>
        <li><code>ppa02_student/data/gdp_per_capita.js</code></li>
        <li><code>ppa02_student/data/life_expectancy.js</code></li>
    </ul>
    These files are already referred to in <code>ppa02_student/index.html</code> file.
    They define the following functions:
    <ul>
        <li><code>getCountryList()</code></li>
        <li><code>getPopulation()</code></li>
        <li><code>getGdpPerCapita()</code></li>
        <li><code>getLifeExpectancy()</code></li>
    </ul>
    Your code should call each of these functions only once to get the data.
    </p>

    <p>
        The return value of <code>getCountryList()</code> is an array containing Javascript objects,
        each corresponding to a country and having the following fields:
    <ul>
        <li><code>name</code>: the name of the country.</li>
        <li><code>region</code>: the name of the region of the country, which can be "Asia", "Europe",
            "Africa" or "America".
        </li>
        <li><code>abbreviation</code>: a three-lettered abbreviation of the country's name.</li>
    </ul>
    </p>

    <p>
        The return values of the three other functions have the same format. Each of them is a
        mapping from country names to arrays containing $2015-1800+1 = 216$ numerical values,
        which are either the population, GDP per capita, or life expectancy from 1800 to 2015.
        Some of the entries might be <code>null</code>, indicating that there's no data point
        for that particular year.
    </p>

    <h2>Hints</h2>

    <h3>Use jQuery and jQuery UI</h3>

    <p>
        We implemented the reference solution with heavy help from <a href="http://jquery.com">jQuery</a>
        and <a href="http://jqueryui.com">jQuery UI</a>, and we could imagine how life would be much more
        difficult without them. We recommend that you take advantage of these libraries too. The template
        code we distribute already has them, so you don't have to figure out how to set them up.
    </p>

    <h3>How to Use UI Widgets</h3>

    <p>
        Past exhibits have code that demonstrate how to use a number of UI widgets.
    </p>

    <ul>
        <li>
            Look at <a href="../lecture02/exhibit02.html">Exhibit #2 of Lecture 2</a> to learn about
            jQuery UI sliders.
        </li>
        <li>
            Look at <a href="../lecture01/exhibit06.html">Exhibit #6 of Lecture 1</a> or
            <a href="ppa01_student/index.html">PPA 1</a> to learn about the <code>select</code> tag.
        </li>
        <li>
            Look at the source code of this web page to see how the "Play!" button is implemented.<br>
            <table>
                <tr>
                    <td align="center" id="currentYear" colspan="3"></td>
                </tr>
                <tr>
                    <td>
                        <button id="playButton">Play!</button>
                    </td>
                    <td width="20"></td>
                    <td>
                        <table>
                            <tr>
                                <td width="720" id="yearSlider"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
            <br>
        </li>
        <li>
            Look at the source of code of this web page to see how to implement the checkboxes.<br><br>

            <h3>Presidents of the United States of America</h3>

            <table>
                <tr>
                    <td width="300">
                        <div style="overflow: auto; height: 320px;" id="presidentCheckBoxes"></div>
                    </td>
                    <td width="10"></td>
                    <td width="300">
                        <div style="overflow: auto; height: 320px" id="presidentList"></div>
                    </td>
                </tr>
            </table><br>
            <button id="selectAllButton">Select All</button> &nbsp;
            <button id="deselectAllButton">Deselect All</button>
        </li>
    </ul>

    <h3>Rendering and Interaction</h3>

    <ul>
        <li>
            Review
            <a href="../lecture02/exhibit03.html">Exhibit #3 of Lecture 2</a>
            to see how to draw circles.
        </li>
        <li>
            Review
            <a href="../lecture03/exhibit02.html">Exhibit #2 of Lecture 3</a>
            to see how to handle mouse events.
        </li>
        <li>
            Use WebGL blending when implementing transparency.  We use <code>SRC_ALPHA</code> and
            <code>ONE_MINUS_SRC_ALPHA</code> as our blend functions.
        </li>
    </ul>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/jquery-ui.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../js/bootstrap.min.js"></script>
<!-- Google Code Prettifier -->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

<script>
    // Year slider and the play button.
    var yearSlider = $("#yearSlider");
    var playButton = $("#playButton");

    yearSlider.slider({
        min: 1800,
        max: 2015
    });

    var isPlaying = false;
    var lastYearUpdate;
    var yearUpdateInterval = 100.0;

    function startPlay() {
        isPlaying = true;
        lastYearUpdate = performance.now();
        yearSlider.slider("disable");
    }

    function stopPlay() {
        isPlaying = false;
        yearSlider.slider("enable");
    }

    playButton.click(function () {
        if (isPlaying) {
            stopPlay();
        } else {
            startPlay();
        }
    });

    function updateUi() {
        var year = yearSlider.slider("value");

        if (isPlaying) {
            if (year == 2015) {
                stopPlay();
            } else {
                var currentTime = performance.now();
                if (currentTime - lastYearUpdate > yearUpdateInterval) {
                    lastYearUpdate = currentTime;
                    yearSlider.slider("value", year + 1);
                }
            }
        }

        year = yearSlider.slider("value");
        $("#currentYear").html("<h1>" + year + "</h1>");

        window.requestAnimationFrame(updateUi);
    }
    window.requestAnimationFrame(updateUi);

    // Checkbox lists.
    var presidents =
        [
            "George Washington",
            "John Adams",
            "Thomas Jefferson",
            "James Madison",
            "James Monroe",
            "John Quincy Adams",
            "Andrew Jackson",
            "Martin Van Buren",
            "William Henry Harrison",
            "John Tyler",
            "James Knox Polk",
            "Zachary Taylor",
            "Millard Fillmore",
            "Franklin Pierce",
            "James Buchanan",
            "Abraham Lincoln",
            "Andrew Johnson",
            "Ulysses S. Grant",
            "Rutherford Birchard Hayes",
            "James Abram Garfield",
            "Chester Alan Arthur",
            "Grover Cleveland",
            "Benjamin Harrison",
            "Grover Cleveland",
            "William McKinley",
            "Theodore Roosevelt",
            "William Howard Taft",
            "Woodrow Wilson",
            "Warren Gamaliel Harding",
            "Calvin Coolidge",
            "Herbert Clark Hoover",
            "Franklin Delano Roosevelt",
            "Harry S. Truman",
            "Dwight David Eisenhower",
            "John Fitzgerald Kennedy",
            "Lyndon Baines Johnson",
            "Richard Milhous Nixon",
            "Gerald Rudolph Ford",
            "James Earl Carter, Jr.",
            "Ronald Wilson Reagan",
            "George Herbert Walker Bush",
            "William Jefferson Clinton",
            "George Walker Bush",
            "Barack Hussein Obama",
            "Donald John Trump"
        ];

    var selectedPresidents = [];

    function updatePresidentList() {
        $("#presidentList").html(
            "<ul>" +
            selectedPresidents.map(function(name) {
                return "<li>" + name + "</li>";
            }).join("") +
            "</ul>"
        );
    }

    function createPresidentCheckBoxes() {
        var presidentHtmls = [];
        var i;
        for(i=0;i<presidents.length;i++) {
            var name = presidents[i];
            presidentHtmls.push("<input type='checkbox' value='" + name + "' id='checkBox" + i + "'> " + name + "<br>");
        }
        $("#presidentCheckBoxes").html(presidentHtmls.join(""));

        function setCheckBoxChangeFunction(i) {
            var checkBoxName = "checkBox" + i;
            var checkBox = $("#" + checkBoxName);
            var name = presidents[i];
            checkBox.change(function() {
                var checked = checkBox.prop("checked");
                if (!checked) {
                    var index = selectedPresidents.indexOf(name);
                    if (index > -1) {
                        selectedPresidents.splice(index,1);
                    }
                } else {
                    selectedPresidents.push(name);
                }
                updatePresidentList();
            });
        }

        for(i=0;i<presidents.length;i++) {
            setCheckBoxChangeFunction(i);
        }
    }
    createPresidentCheckBoxes();

    function addPresident(name) {
        var index = presidents.indexOf(name);
        if (index > -1) {
            var checkBoxName = "checkBox" + index;
            var checkBox = $("#" + checkBoxName);
            if (!checkBox.prop("checked")) {
                checkBox.prop("checked", true);
                selectedPresidents.push(name);
            }
        }
    }

    function removePresident(name) {
        var index = presidents.indexOf(name);
        if (index > -1) {
            var checkBoxName = "checkBox" + index;
            var checkBox = $("#" + checkBoxName);
            if (checkBox.prop("checked")) {
                selectedPresidents.splice(name, 1);
                checkBox.prop("checked", false);
            }
        }
    }

    $("#selectAllButton").click(function() {
        presidents.forEach(addPresident);
        updatePresidentList();
    });

    $("#deselectAllButton").click(function() {
        presidents.forEach(removePresident);
        updatePresidentList();
    });
</script>

</body>
</html>